<!-- src/html/hub.html - FINAL, COMPLETE, AND CORRECTED -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friends Hub // [CLASSIFIED]</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="css/friends.css">
</head>
<body>
    <!-- OVERLAYS AND EFFECTS -->
    <div id="scanline-overlay"></div>
    <canvas id="cmatrix-canvas"></canvas>
    <div id="shutdown-overlay" class="hidden"><div id="shutdown-text"></div></div>
    <div id="ping-overlay" class="hidden"></div>
    <div id="lockdown-overlay" class="hidden"></div>
    <div id="lockdown-banner" class="hidden">SYSTEM LOCKDOWN IN EFFECT</div>
    <div id="achievement-toast" class="hidden"></div>

    <div id="main-hub" class="hub-screen active">
        <header class="hub-header">
            <div>
                <h1 class="glitch" data-text="[ COVERT_OPS_HUB ]">[ COVERT_OPS_HUB ]</h1>
                <p>Welcome, <span id="user-display-name">Agent</span>. // STATUS: <span class="status-ok">SECURE</span></p>
            </div>
            <div class="header-actions">
                <div id="volume-controls" class="volume-controls">
                    <button id="mute-button" title="Mute/Unmute Sound"><i class='bx bxs-volume-full'></i></button>
                    <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1" title="Adjust Volume">
                </div>
                <button id="terminal-toggle-btn" class="glitch-link small" title="Open System Shell (Ctrl + `)" data-text="SHELL"><i class='bx bx-terminal'></i></button>
                <button id="logout-button" class="glitch-link" data-text="GO_DARK">GO_DARK</button>
            </div>
        </header>
        <main class="hub-content-grid">
            <div class="left-column">
                <div class="hub-module" id="chat-module">
                    <h2 class="module-title">PUBLIC COMMS</h2>
                    <div id="chat-messages" class="chat-messages"></div>
                    <div id="typing-indicator" class="typing-indicator"></div>
                    <form id="chat-form" class="chat-form">
                        <input type="text" id="chat-input" placeholder="Transmit secure message..." required autocomplete="off">
                        <button type="button" id="self-destruct-btn" class="special-action-btn" title="Send self-destructing message"><i class='bx bxs-bomb'></i></button>
                        <button type="submit" id="send-btn"><i class='bx bxs-paper-plane'></i></button>
                    </form>
                </div>
                <div class="hub-module" id="system-log-module">
                    <h2 class="module-title"><a href="register.html" style="text-decoration: none;">SYSTEM_EVENT_LOG</a></h2>
                    <div id="log-filters" class="log-filters">
                        <button class="log-filter-btn active" data-filter="all">ALL</button>
                        <button class="log-filter-btn" data-filter="system">SYSTEM</button>
                        <button class="log-filter-btn" data-filter="chat">CHAT</button>
                        <button class="log-filter-btn" data-filter="game">GAME</button>
                    </div>
                    <div id="system-log" class="system-log"></div>
                </div>
                <div class="hub-module" id="file-send-module">
                    <h2 class="module-title">FILE TRANSMISSION</h2>
                    <div id="file-transfer-area" class="file-transfer-area">
                        <p>Drag & Drop file or click to select</p>
                        <i class='bx bxs-file-archive'></i>
                        <input type="file" id="file-upload-input" class="hidden" accept="image/*, application/pdf, .zip, .rar, .txt">
                    </div>
                </div>
                <div class="hub-module" id="intel-feed-module">
                    <h2 class="module-title">INTEL_FEED</h2>
                    <div id="intel-ticker" class="intel-ticker">
                        <div class="intel-item">
                            <span class="intel-tag system">STATUS</span>
                            <p class="intel-text">Initializing secure connection to intel servers...</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="right-column">
                <div class="hub-module" id="agents-module">
                    <h2 class="module-title">ACTIVE_AGENTS</h2>
                    <ul id="active-users-list" class="active-users-list"></ul>
                </div>
                <div class="hub-module" id="network-status-module">
                    <h2 class="module-title">NETWORK_STATUS</h2>
                    <div class="status-graph"><div class="graph-label">Data Uplink</div><div class="graph-bar-container"><div id="uplink-bar" class="graph-bar"></div></div></div>
                    <div class="status-graph"><div class="graph-label">System Integrity</div><div class="graph-bar-container"><div id="integrity-bar" class="graph-bar"></div></div></div>
                    <div class="status-graph"><div class="graph-label">Firewall Status</div><div class="graph-bar-container"><div id="firewall-bar" class="graph-bar"></div></div></div>
                </div>
                <div class="hub-module" id="chat-channels-module">
                    <h2 class="module-title">CHAT_CHANNELS</h2>
                    <ul id="chat-channels-list" class="chat-channels-list"></ul>
                </div>
                <div class="hub-module" id="user-controls-module">
                    <h2 class="module-title">AGENT_CONTROLS</h2>
                    <form id="status-form" class="status-form"><input type="text" id="status-input" placeholder="Set your status..." autocomplete="off"><button type="submit" class="glitch-link small">SET</button></form>
                    <button id="purge-comms-btn" class="glitch-link return-link small" data-text="PURGE_COMMS">PURGE_COMMS</button>
                </div>
                <div class="hub-module" id="game-module">
                    <h2 class="module-title">STRAT_SIM [Tic-Tac-Toe]</h2>
                    <div id="game-status" class="game-status">Awaiting player challenge...</div>
                    <div id="tic-tac-toe-board" class="tic-tac-toe-board">
                        <div class="cell" data-index="0"></div><div class="cell" data-index="1"></div><div class="cell" data-index="2"></div>
                        <div class="cell" data-index="3"></div><div class="cell" data-index="4"></div><div class="cell" data-index="5"></div>
                        <div class="cell" data-index="6"></div><div class="cell" data-index="7"></div><div class="cell" data-index="8"></div>
                    </div>
                    <button id="reset-game-button" class="glitch-link small" data-text="RESET_SIM">RESET_SIM</button>
                </div>
            </div>
        </main>
    </div>
    
    <!-- SYSTEM SHELL / TERMINAL -->
    <div id="terminal-container" class="hub-module hidden">
        <div class="terminal-header"><span>/bin/hub_shell</span><button id="terminal-close-btn" class="terminal-close-btn">&times;</button></div>
        <div id="terminal-output" class="terminal-output"></div>
        <div class="terminal-input-line"><span class="terminal-prompt">AGENT@COVERT_HUB:~$</span><input type="text" id="terminal-input" class="terminal-input" autocomplete="off"></div>
    </div>

    <!-- AGENT DOSSIER MODAL -->
    <div id="dossier-modal" class="modal-container hidden">
        <div class="modal-content dossier-content">
            <button id="dossier-close-btn" class="modal-close-btn">&times;</button>
            <div id="dossier-body"></div>
        </div>
    </div>
    
    <!-- FILE DESTINATION MODAL -->
    <div id="file-destination-modal" class="modal-container hidden">
        <div class="modal-content">
            <h3 class="module-title">TRANSMIT FILE</h3>
            
            <div id="file-preview-area" class="file-preview-area">
                <!-- Preview content (image or icon) will be injected by JS -->
            </div>
            
            <p>Select a channel or agent to receive this file.</p>
            <form id="file-destination-form">
                <select id="file-destination-select" class="modal-select" required>
                    <!-- Options will be populated by JS -->
                </select>
                <div class="modal-actions">
                    <button type="button" id="file-destination-cancel" class="glitch-link small return-link">CANCEL</button>
                    <button type="submit" class="glitch-link small">SEND FILE</button>
                </div>
            </form>
        </div>
    </div>

    <!-- AUDIO FILES -->
    <!-- FIX: Corrected all audio paths to be absolute -->
    <audio id="whisper-sound" src="../../assets/sounds/whisper.mp3" preload="auto"></audio>
    <audio id="connect-sound" src="../../assets/sounds/connect.mp3" preload="auto"></audio>
    <audio id="disconnect-sound" src="../../assets/sounds/disconnect.mp3" preload="auto"></audio>
    <audio id="message-sound" src="../../assets/sounds/message.mp3" preload="auto"></audio>
    <audio id="error-sound" src="../../assets/sounds/error.mp3" preload="auto"></audio>
    <audio id="ping-sound" src="../../assets/sounds/ping.mp3" preload="auto"></audio>
    <audio id="typing-sound" src="../../assets/sounds/typing.mp3" preload="auto" loop></audio>
    <audio id="alarm-sound" src="../../assets/sounds/alarm.mp3" preload="auto"></audio>
    <audio id="achievement-sound" src="../../assets/sounds/achievement.mp3" preload="auto"></audio>
    
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="js/hub.js"></script>
</body>
</html>