<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Character Sheet | LHA Collective</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;900&family=Space+Grotesk:wght@700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'display': ['"Space Grotesk"', 'sans-serif'],
                        'body': ['"Outfit"', 'sans-serif'],
                        'mono': ['"JetBrains Mono"', 'monospace'],
                    },
                    colors: {
                        'ink': '#09090b', 'paper': '#fdfbf7', 'primary': '#8b5cf6',
                        'pop-pink': '#ff2a6d', 'cyber-cyan': '#05d9e8', 'neon-lime': '#d1f25e',
                    },
                    backgroundImage: {
                        'grid': "linear-gradient(to right, #e5e7eb 1px, transparent 1px), linear-gradient(to bottom, #e5e7eb 1px, transparent 1px)",
                        'grid-dark': "linear-gradient(to right, #27272a 1px, transparent 1px), linear-gradient(to bottom, #27272a 1px, transparent 1px)",
                    },
                    boxShadow: {
                        'manga': '4px 4px 0px 0px #09090b',
                        'manga-white': '4px 4px 0px 0px #ffffff',
                        'neon': '0 0 10px rgba(139, 92, 246, 0.5)',
                        'manga-sm': '2px 2px 0px 0px #09090b',
                    }
                }
            }
        }
    </script>
    <style>
        .bg-grid-pattern { background-size: 30px 30px; }
        /* Desktop Active State */
        .lg-nav-btn.active {
            background-color: #09090b;
            color: #d1f25e;
            border-color: #09090b;
        }
        .dark .lg-nav-btn.active {
            background-color: #ffffff;
            color: #09090b;
            border-color: #ffffff;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        /* Mobile Active State */
        .mobile-nav-btn.active {
            color: #8b5cf6; /* Primary */
            background-color: rgba(139, 92, 246, 0.1);
        }
        .dark .mobile-nav-btn.active {
            color: #d1f25e; /* Neon Lime */
            background-color: rgba(209, 242, 94, 0.1);
        }

        .animate-fade-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Hide Scrollbar on mobile for cleaner look */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none;  scrollbar-width: none; }
    </style>
</head>
<body class="text-ink bg-paper dark:bg-black dark:text-gray-200 font-body transition-colors duration-500 pb-28 lg:pb-0">

    <div class="fixed inset-0 z-[-1] bg-grid bg-grid-pattern dark:bg-grid-dark opacity-40 dark:opacity-10 pointer-events-none"></div>

    <!-- Auth Check -->
    <script>
        if (localStorage.getItem('isLoggedIn') !== 'true' || !localStorage.getItem('userId')) { 
            window.location.href = '/src/screens/auth/signin.html'; 
        }
    </script>

    <!-- Navbar -->
    <nav class="fixed top-0 left-0 right-0 z-50 px-4 py-4">
        <div class="container mx-auto max-w-6xl">
            <div class="bg-white/90 dark:bg-zinc-900/90 backdrop-blur border-2 border-ink dark:border-zinc-700 rounded-xl px-5 py-3 flex justify-between items-center shadow-manga dark:shadow-none">
                <a href="/index.html" class="flex items-center gap-2 font-mono font-bold text-xs uppercase hover:text-primary transition-colors">
                    <i class="fas fa-arrow-left"></i> <span class="hidden sm:inline">Exit Game</span><span class="sm:hidden">Exit</span>
                </a>
                <div class="flex items-center gap-4">
                    <div class="hidden md:flex items-center gap-2 font-mono text-[10px] tracking-widest bg-gray-100 dark:bg-zinc-800 px-2 py-1 rounded border border-gray-200 dark:border-zinc-700">
                        <span class="text-green-500 animate-pulse">‚óè</span> SERVER_ONLINE
                    </div>
                    <button id="theme-toggle" class="w-8 h-8 rounded border border-gray-300 dark:border-zinc-600 flex items-center justify-center hover:bg-gray-100 dark:hover:bg-zinc-800 transition-colors">
                        <i class="fas fa-moon block dark:hidden text-xs"></i>
                        <i class="fas fa-sun hidden dark:block text-xs text-yellow-400"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="pt-28 lg:pt-32 pb-6 px-4">
        <div class="container mx-auto max-w-6xl">
            
            <!-- MOBILE ONLY: Compact Player Header -->
            <div class="lg:hidden mb-6 animate-fade-in">
                <div class="bg-white dark:bg-zinc-900 border-2 border-ink dark:border-zinc-700 rounded-xl p-4 shadow-manga-sm flex items-center gap-4 relative overflow-hidden">
                    <!-- Background Accent -->
                    <div class="absolute right-0 top-0 h-full w-16 bg-gradient-to-l from-gray-100 to-transparent dark:from-zinc-800 opacity-50"></div>
                    
                    <div class="relative">
                        <img src="/src/assets/default-avatar.jpg" id="mobile-player-avatar" class="w-16 h-16 rounded-lg border-2 border-ink dark:border-white object-cover bg-gray-200">
                        <div id="mobile-player-level" class="absolute -bottom-2 -right-2 bg-neon-lime text-ink text-[8px] font-bold px-1.5 py-0.5 border border-ink rounded z-20">LVL. ?</div>
                    </div>
                    
                    <div class="flex-1 min-w-0 z-10">
                        <h2 id="mobile-player-username" class="font-display font-black text-lg uppercase truncate leading-none mb-1">Loading...</h2>
                        <p class="text-xs font-mono text-primary mb-2 truncate" id="mobile-player-job">Class: ...</p>
                        
                        <!-- Mobile XP Bar -->
                        <div class="flex items-center gap-2">
                            <div class="flex-1 bg-gray-200 dark:bg-zinc-800 h-1.5 rounded-full overflow-hidden border border-gray-300 dark:border-zinc-600">
                                <div id="mobile-xp-bar" class="bg-gradient-to-r from-primary to-pop-pink h-full w-[0%]"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DESKTOP GRID -->
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                
                <!-- Sidebar (Desktop Player Card) - HIDDEN ON MOBILE -->
                <aside class="hidden lg:block lg:col-span-1 space-y-6">
                    <div class="bg-white dark:bg-zinc-900 border-2 border-ink dark:border-zinc-700 rounded-xl p-0 overflow-hidden shadow-manga dark:shadow-neon transition-all">
                        <div class="bg-ink dark:bg-white text-white dark:text-ink p-2 text-center font-mono text-[10px] uppercase font-bold tracking-widest">Player Card</div>
                        <div class="p-6 text-center">
                            <div class="relative inline-block mb-4 group">
                                <div class="absolute inset-0 bg-primary rounded-full blur opacity-20 group-hover:opacity-40 transition-opacity"></div>
                                <img src="/src/assets/default-avatar.jpg" alt="Avatar" id="player-avatar" class="w-24 h-24 rounded-full border-4 border-ink dark:border-white object-cover bg-gray-200 relative z-10 cursor-pointer" title="Click to change avatar">
                                <input type="file" id="avatar-upload-input" class="hidden" accept="image/*">
                                <div id="player-level" class="absolute -bottom-2 -right-2 bg-neon-lime text-ink text-[10px] font-bold px-2 py-1 border-2 border-ink rounded z-20">LVL. ?</div>
                            </div>
                            <h2 id="player-username" class="font-display font-black text-xl uppercase mb-1">Loading...</h2>
                            <p class="text-gray-500 dark:text-gray-400 text-xs font-mono mb-6">Class: <span id="player-job-class" class="text-primary">...</span></p>
                            
                            <!-- XP Bar -->
                            <div class="w-full bg-gray-200 dark:bg-zinc-800 h-3 border border-ink dark:border-zinc-600 rounded-full overflow-hidden mb-1 relative">
                                <div id="player-xp-bar" class="bg-gradient-to-r from-primary to-pop-pink h-full w-[0%] transition-all duration-500"></div>
                                <div class="absolute inset-0 bg-[url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAIklEQVQIW2NkQAKrVq36zwjjgzhhYWGMYAEYB8RmROaABADeOQ8CXl/xfgAAAABJRU5ErkJggg==')] opacity-20"></div>
                            </div>
                            <div class="flex justify-between text-[10px] font-mono text-gray-400 font-bold">
                                <span>XP</span>
                                <span id="player-xp-text">0 / 0</span>
                            </div>
                        </div>
                    </div>

                    <nav class="flex flex-col gap-3">
                        <button data-tab="overview" class="account-nav-link lg-nav-btn active text-left px-4 py-3 border-2 border-transparent rounded-lg font-display font-bold uppercase text-sm hover:border-gray-200 dark:hover:border-zinc-700 transition-all flex items-center gap-3">
                            <i class="fas fa-id-card w-4 text-center"></i> Character Sheet
                        </button>
                        
                        <button data-tab="projects" class="account-nav-link lg-nav-btn text-left px-4 py-3 border-2 border-transparent rounded-lg font-display font-bold uppercase text-sm hover:border-gray-200 dark:hover:border-zinc-700 transition-all flex items-center gap-3">
                            <i class="fas fa-scroll w-4 text-center"></i> Quest Log
                        </button>

                        <button id="logout-btn" class="text-left px-4 py-3 border-2 border-transparent rounded-lg font-display font-bold uppercase text-sm text-pop-pink hover:bg-pop-pink/10 transition-all mt-4 border-t border-gray-200 dark:border-zinc-800 flex items-center gap-3">
                            <i class="fas fa-power-off w-4 text-center"></i> Disconnect
                        </button>
                    </nav>
                </aside>

                <!-- Main Panel -->
                <div class="lg:col-span-3">
                    <!-- System Header -->
                    <div class="flex items-center gap-1 mb-[-2px] px-2">
                        <div class="bg-ink dark:bg-white text-white dark:text-ink px-6 py-2 font-mono text-xs font-bold border-2 border-ink dark:border-white border-b-0 rounded-t-lg">
                            <i class="fas fa-terminal mr-2"></i><span id="folder-label">overview.sys</span>
                        </div>
                        <div class="h-2 w-2 bg-ink dark:bg-white rounded-full opacity-50"></div>
                        <div class="h-2 w-2 bg-ink dark:bg-white rounded-full opacity-25"></div>
                    </div>

                    <div class="bg-white dark:bg-zinc-900 border-2 border-ink dark:border-white rounded-b-xl rounded-tr-xl shadow-manga dark:shadow-[0_0_20px_rgba(255,255,255,0.1)] p-6 md:p-10 min-h-[600px] relative overflow-hidden">
                        
                        <!-- Background decoration -->
                         <div class="absolute top-0 right-0 p-10 opacity-5 pointer-events-none">
                            <i class="fas fa-fingerprint text-9xl"></i>
                        </div>

                        <!-- 1. OVERVIEW TAB -->
                        <div id="overview-pane" class="tab-pane block animate-fade-in relative z-10">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 border-b border-gray-200 dark:border-zinc-700 pb-6 gap-4">
                                <div>
                                    <h1 class="font-display font-black text-2xl md:text-4xl uppercase tracking-tight">Stats & Config</h1>
                                    <p class="text-gray-500 font-mono text-xs mt-1">Manage your public profile settings.</p>
                                </div>
                                <button id="save-profile-btn" class="w-full md:w-auto bg-neon-lime text-ink border-2 border-ink px-6 py-2 rounded-lg font-bold text-xs uppercase shadow-manga-sm hover:translate-y-0.5 hover:shadow-none transition-all">
                                    <i class="fas fa-save mr-2"></i> Save Changes
                                </button>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                                <div class="space-y-8">
                                    <!-- Attribute Box -->
                                    <div class="bg-gray-50 dark:bg-black p-5 border-2 border-dashed border-gray-300 dark:border-zinc-700 rounded-xl">
                                        <h3 class="font-mono font-bold text-xs text-gray-500 mb-5 uppercase tracking-wider flex items-center gap-2">
                                            <i class="fas fa-chart-bar"></i> Attributes
                                        </h3>
                                        <div class="space-y-5">
                                            <div>
                                                <div class="flex justify-between text-[10px] font-bold mb-1.5 font-mono">
                                                    <span>INT (Code)</span><span id="attr-int-text" class="text-primary">LVL ?</span>
                                                </div>
                                                <div class="w-full bg-gray-200 dark:bg-zinc-800 h-2 rounded-full overflow-hidden border border-gray-300 dark:border-zinc-600"><div id="attr-int-bar" class="bg-primary h-full w-[0%] shadow-[0_0_10px_#8b5cf6]"></div></div>
                                            </div>
                                            <div>
                                                <div class="flex justify-between text-[10px] font-bold mb-1.5 font-mono">
                                                    <span>DEX (Design)</span><span id="attr-dex-text" class="text-pop-pink">LVL ?</span>
                                                </div>
                                                <div class="w-full bg-gray-200 dark:bg-zinc-800 h-2 rounded-full overflow-hidden border border-gray-300 dark:border-zinc-600"><div id="attr-dex-bar" class="bg-pop-pink h-full w-[0%] shadow-[0_0_10px_#ff2a6d]"></div></div>
                                            </div>
                                            <div>
                                                <div class="flex justify-between text-[10px] font-bold mb-1.5 font-mono">
                                                    <span>CHA (Comms)</span><span id="attr-cha-text" class="text-cyber-cyan">LVL ?</span>
                                                </div>
                                                <div class="w-full bg-gray-200 dark:bg-zinc-800 h-2 rounded-full overflow-hidden border border-gray-300 dark:border-zinc-600"><div id="attr-cha-bar" class="bg-cyber-cyan h-full w-[0%] shadow-[0_0_10px_#05d9e8]"></div></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Badges -->
                                    <div>
                                        <h3 class="font-mono font-bold text-xs text-gray-500 mb-3 uppercase tracking-wider">Inventory / Badges</h3>
                                        <div class="grid grid-cols-4 gap-3">
                                            <div class="aspect-square bg-white dark:bg-zinc-800 border-2 border-gray-200 dark:border-zinc-600 rounded-lg flex items-center justify-center text-xl hover:border-primary cursor-help transition-colors" title="Early Adopter">üöÄ</div>
                                            <div class="aspect-square bg-white dark:bg-zinc-800 border-2 border-gray-200 dark:border-zinc-600 rounded-lg flex items-center justify-center text-xl hover:border-pop-pink cursor-help transition-colors" title="Bug Hunter">üêõ</div>
                                            <div class="aspect-square bg-white dark:bg-zinc-800 border-2 border-gray-200 dark:border-zinc-600 rounded-lg flex items-center justify-center text-xl hover:border-cyber-cyan cursor-help transition-colors" title="Scholar">üìú</div>
                                            <div class="aspect-square border-2 border-dashed border-gray-300 dark:border-zinc-700 rounded-lg flex items-center justify-center text-gray-400 text-xs font-mono">EMPTY</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="md:col-span-2 space-y-6">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label class="block font-bold mb-2 text-xs font-mono uppercase text-gray-500">Display Name</label>
                                            <input type="text" id="displayName-input" class="w-full bg-gray-50 dark:bg-black border-2 border-gray-200 dark:border-zinc-700 rounded-lg p-3 font-medium focus:border-ink dark:focus:border-white focus:outline-none transition-all">
                                        </div>
                                        <div>
                                            <label class="block font-bold mb-2 text-xs font-mono uppercase text-gray-500">Job Class</label>
                                            <div class="relative">
                                                <select id="jobClass-select" class="w-full bg-gray-50 dark:bg-black border-2 border-gray-200 dark:border-zinc-700 rounded-lg p-3 font-medium focus:border-ink dark:focus:border-white focus:outline-none appearance-none transition-all">
                                                    <option>Webmancer (Developer)</option>
                                                    <option>Pixel Artist (Designer)</option>
                                                    <option>Game Master (Manager)</option>
                                                </select>
                                                <i class="fas fa-chevron-down absolute right-4 top-4 text-xs pointer-events-none text-gray-400"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block font-bold mb-2 text-xs font-mono uppercase text-gray-500">Bio / Status</label>
                                        <textarea id="bio-textarea" rows="3" class="w-full bg-gray-50 dark:bg-black border-2 border-gray-200 dark:border-zinc-700 rounded-lg p-3 font-medium focus:border-ink dark:focus:border-white focus:outline-none text-sm transition-all resize-none"></textarea>
                                    </div>
                                    
                                    <div class="bg-blue-50/50 dark:bg-zinc-800/50 p-6 rounded-xl border border-blue-100 dark:border-zinc-700">
                                        <h3 class="font-mono font-bold text-xs text-blue-500 dark:text-blue-400 mb-4 uppercase tracking-wider flex items-center gap-2">
                                            <i class="fas fa-link"></i> Linked Equipment
                                        </h3>
                                        <div class="grid grid-cols-1 gap-4">
                                            <div class="flex items-center group">
                                                <span class="w-12 h-10 bg-white dark:bg-zinc-800 border-2 border-gray-200 dark:border-zinc-600 flex items-center justify-center rounded-l-lg border-r-0 group-focus-within:border-ink dark:group-focus-within:border-white transition-colors"><i class="fab fa-github"></i></span>
                                                <input type="text" id="github-input" placeholder="github.com/username" class="flex-1 bg-white dark:bg-zinc-900 border-2 border-gray-200 dark:border-zinc-600 rounded-r-lg p-2 h-10 text-sm focus:border-ink dark:focus:border-white focus:outline-none transition-colors">
                                            </div>
                                            <div class="flex items-center group">
                                                <span class="w-12 h-10 bg-white dark:bg-zinc-800 border-2 border-gray-200 dark:border-zinc-600 flex items-center justify-center rounded-l-lg border-r-0 group-focus-within:border-ink dark:group-focus-within:border-white transition-colors"><i class="fas fa-globe"></i></span>
                                                <input type="text" id="portfolio-input" placeholder="yourportfolio.com" class="flex-1 bg-white dark:bg-zinc-900 border-2 border-gray-200 dark:border-zinc-600 rounded-r-lg p-2 h-10 text-sm focus:border-ink dark:focus:border-white focus:outline-none transition-colors">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="pt-6 mt-6 border-t border-gray-100 dark:border-zinc-800">
                                        <button class="w-full md:w-auto text-xs font-bold text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 px-4 py-3 md:py-2 rounded border border-red-100 dark:border-transparent md:border-transparent text-center md:text-left transition-colors uppercase tracking-wide">
                                            <i class="fas fa-trash mr-2"></i> Delete Save File
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 2. PROJECTS TAB -->
                        <div id="projects-pane" class="tab-pane hidden animate-fade-in relative z-10">
                            <div class="flex flex-col md:flex-row justify-between items-end mb-8 border-b border-gray-200 dark:border-zinc-700 pb-6 gap-4">
                                <div>
                                    <h1 class="font-display font-black text-2xl md:text-4xl uppercase">Active Quests</h1>
                                    <p class="text-gray-500 dark:text-gray-400 font-mono text-sm mt-1">Current mission log and submissions.</p>
                                </div>
                                <a href="/src/screens/projects/myprojects.html" class="bg-ink dark:bg-white text-white dark:text-ink border-2 border-transparent px-5 py-2 rounded-lg font-bold text-xs uppercase shadow-lg hover:-translate-y-0.5 transition-all">
                                    Full Directory <i class="fas fa-arrow-right ml-2"></i>
                                </a>
                            </div>

                            <div id="account-projects-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                                <!-- Projects will load here -->
                            </div>

                                <!-- Empty State / CTA -->
                                <a href="/src/screens/projects/start-project.html" class="block border-2 border-dashed border-gray-300 dark:border-zinc-700 rounded-xl p-8 text-center hover:bg-gray-50 dark:hover:bg-zinc-900 hover:border-gray-400 dark:hover:border-zinc-500 transition-all group mt-6">
                                    <div class="w-12 h-12 bg-gray-100 dark:bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                                        <i class="fas fa-plus text-gray-400 group-hover:text-ink dark:group-hover:text-white"></i>
                                    </div>
                                    <p class="text-sm font-bold text-gray-500 group-hover:text-ink dark:group-hover:text-white uppercase">Accept New Quest</p>
                                </a>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- MOBILE BOTTOM NAVIGATION (Floating Dock) -->
    <nav class="lg:hidden fixed bottom-6 left-6 right-6 z-50 animate-fade-in">
        <div class="bg-white/95 dark:bg-zinc-900/95 backdrop-blur-md border-2 border-ink dark:border-zinc-700 rounded-2xl shadow-neon p-2 flex justify-between items-center">
            
            <button data-tab="overview" class="account-nav-link mobile-nav-btn active flex-1 flex flex-col items-center justify-center gap-1 py-2 rounded-xl transition-all">
                <i class="fas fa-id-card text-lg"></i>
                <span class="text-[9px] font-bold font-mono uppercase">Sheet</span>
            </button>
            
            <div class="w-px h-8 bg-gray-200 dark:bg-zinc-700"></div>
            
            <button data-tab="projects" class="account-nav-link mobile-nav-btn flex-1 flex flex-col items-center justify-center gap-1 py-2 rounded-xl transition-all">
                <i class="fas fa-scroll text-lg"></i>
                <span class="text-[9px] font-bold font-mono uppercase">Quests</span>
            </button>
            
            <div class="w-px h-8 bg-gray-200 dark:bg-zinc-700"></div>
            
            <button id="mobile-logout-btn" class="flex-1 flex flex-col items-center justify-center gap-1 py-2 rounded-xl text-pop-pink hover:bg-pop-pink/10 transition-all">
                <i class="fas fa-power-off text-lg"></i>
                <span class="text-[9px] font-bold font-mono uppercase">Exit</span>
            </button>
            
        </div>
    </nav>

    <div id="alert-modal-placeholder"></div>

    <!-- SCRIPTS -->
    <script src="/src/js/main/alert.js"></script>
    <script src="/src/js/connections/account.js"></script>
    <script>
        // --- MOBILE-SPECIFIC JS EXTENSIONS ---
        // We inject this directly here to handle the mobile-specific elements without
        // breaking your existing external file logic.
        
        document.addEventListener('DOMContentLoaded', () => {
            // Theme Logic
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark')
            } else {
                document.documentElement.classList.remove('dark')
            }
            document.getElementById('theme-toggle').addEventListener('click', function() {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    localStorage.theme = 'light';
                } else {
                    document.documentElement.classList.add('dark');
                    localStorage.theme = 'dark';
                }
            });

            // Sync Mobile Logout with Desktop Logout
            const mobileLogout = document.getElementById('mobile-logout-btn');
            const desktopLogout = document.getElementById('logout-btn');
            if(mobileLogout && desktopLogout) {
                mobileLogout.addEventListener('click', (e) => {
                    desktopLogout.click();
                });
            }

            // Sync Mobile Header Data with Desktop Data
            // This runs in a loop to ensure data from fetchAndPopulateProfile (which runs async)
            // gets mirrored to the mobile header when it arrives.
            const syncMobileHeader = () => {
                // Avatars
                const dAvatar = document.getElementById('player-avatar');
                const mAvatar = document.getElementById('mobile-player-avatar');
                if(dAvatar && mAvatar) mAvatar.src = dAvatar.src;

                // Username
                const dName = document.getElementById('player-username');
                const mName = document.getElementById('mobile-player-username');
                if(dName && mName) mName.innerText = dName.innerText;

                // Level
                const dLevel = document.getElementById('player-level');
                const mLevel = document.getElementById('mobile-player-level');
                if(dLevel && mLevel) mLevel.innerText = dLevel.innerText;

                // Job
                const dJob = document.getElementById('player-job-class');
                const mJob = document.getElementById('mobile-player-job');
                if(dJob && mJob) mJob.innerText = "Class: " + dJob.innerText;

                // XP Bar
                const dXP = document.getElementById('player-xp-bar');
                const mXP = document.getElementById('mobile-xp-bar');
                if(dXP && mXP) mXP.style.width = dXP.style.width;
            };

            // Run sync every 500ms for a few seconds to catch the API load
            let attempts = 0;
            const syncInterval = setInterval(() => {
                syncMobileHeader();
                attempts++;
                if(attempts > 20) clearInterval(syncInterval); // Stop after 10 seconds
            }, 500);
            
            // Also sync on click of "Save Profile"
            const saveBtn = document.getElementById('save-profile-btn');
            if(saveBtn) {
                saveBtn.addEventListener('click', () => {
                    setTimeout(syncMobileHeader, 1000);
                });
            }
        });

        function logout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userId'); 
            window.location.href = '/src/screens/main/index.html';
        }
    </script>
</body>
</html>